/**
 * LBS lazyloadIMG 
 * Date: 2012-4-15 
 **/
!function(){window.lazyloadIMG=function(a){var b={container:window,event:"scroll",attribute:"_src",delay:100,onLoad:function(){},onEnd:function(){}};for(var c in a)void 0!==a[c]&&(b[c]=a[c]);this.container=b.container,this.event=b.event,this.attribute=b.attribute,this.delay=b.delay,this.onLoad=b.onLoad,this.onEnd=b.onEnd,this.data=[],this.loadIMG=[],this.imgs=null,this._init()},lazyloadIMG.prototype={_init:function(){if(this.imgs=this.container==window?document.getElementsByTagName("img"):this.container.getElementsByTagName("img"),!(this.imgs.length<1)){for(var a=0,b=this.imgs.length;b>a;a++){var c=this.imgs[a];c.getAttribute(this.attribute)&&this.data.push({img:c,w:parseInt(this.getStyle(c,"width"))||parseInt(c.width)||parseInt(c.offsetWidth),h:parseInt(this.getStyle(c,"height"))||parseInt(c.height)||parseInt(c.offsetHeight)})}this.count=this.length=this.data.length,this._css(),this._load(),this._bind()}},_load:function(){if(!(this.count<1)){this.loadIMG.length=0;for(var a=0;a<this.length;a++)if(!this.data[a].img.loaded){var b=this.data[a].img,c=this.data[a].w,d=this.data[a].h;!this._isHidden(b)&&this._isVisible(b,c,d)&&(b.setAttribute("src",b.getAttribute(this.attribute)),b.removeAttribute(this.attribute),b.loaded=!0,this.count--,this.loadIMG.push(b))}this.onLoad&&this.onLoad(this.loadIMG)}},_css:function(){this.wWidth=this.getWindowSize().w,this.wHeight=this.getWindowSize().h,this._scroll()},_scroll:function(){this.scrollX=this.getScroll().x,this.scrollY=this.getScroll().y},_bind:function(){var a=this,b=function(c){if(c=c||window.event,a.count<1)return a.container!=window&&"scroll"!=a.event?a.off(a.container,a.event,b):a.container==window&&"scroll"!=a.event&&a.off(document,a.event,b),a.off(window,"scroll",b),a.off(window,"resize",b),void(a.onEnd&&a.onEnd());switch(c.type){case"scroll":a._scroll();break;case"resize":a._css()}a.timer&&clearTimeout(a.timer),a.timer=setTimeout(function(){a._load()},a.delay)};this.container!=window&&"scroll"!=this.event?this.on(this.container,this.event,b):this.container==window&&"scroll"!=this.event&&this.on(document,this.event,b),this.on(window,"scroll",b),this.on(window,"resize",b)},_isHidden:function(a){if("none"==this.getStyle(a,"display"))return!0;for(;a=a.parentNode;)if(1===a.nodeType&&"none"==this.getStyle(a,"display"))return!0;return!1},_isVisible:function(a,b,c,d,e){var f=this.getPosition(a).x,g=this.getPosition(a).y,h=f+b,i=g+c,j=this.scrollX,k=this.scrollY,l=j+this.wWidth,m=k+this.wHeight;return l>f&&h>j&&m>g&&i>k},on:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},off:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null},getWindowSize:function(){var a=document,b=a.documentElement,c=a.body,d=b.clientWidth||c.clientWidth,e=b.clientHeight||c.clientHeight;return"CSS1Compat"!=a.compatMode&&(d=c.clientWidth,e=c.clientHeight),{w:d,h:e}},getScroll:function(){var a=document,b=a.documentElement,c=a.body,d=b.scrollLeft||c.scrollLeft,e=b.scrollTop||c.scrollTop;return"CSS1Compat"!=a.compatMode&&(d=c.scrollLeft,e=c.scrollTop),{x:d,y:e}},getPosition:function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument,d=c.body,e=c.documentElement,f=e.clientTop||d.clientTop||0,g=e.clientLeft||d.clientLeft||0,h=b.left+(self.pageXOffset||e.scrollLeft||d.scrollLeft)-g,i=b.top+(self.pageYOffset||e.scrollTop||d.scrollTop)-f;return{x:h,y:i}},getStyle:function(a,b){return a.currentStyle?a.currentStyle[b]:getComputedStyle(a,null)[b]}}}();